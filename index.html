<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlexStore</title>
    <!-- <script src="//unpkg.com/alpinejs" defer></script> -->
    <link href="./style.css" rel="stylesheet" />
  </head>
  <body x-data="store" class="bg-pink-50 min-h-screen g-10">
    <!-- Navigation Bar -->
    <nav
      x-data="{open: false}"
      class="fixed w-full bg-pink-600 p-4 text-pink-50 shadow-lg"
    >
      <div class="container mx-auto flex justify-between items-center">
        <div class="text-lg font-bold">My FlexStore</div>
        <div class="hidden md:flex">
          <a href="#" class="mr-4 hover:underline">Wishlist</a>
          <a href="#" class="mr-4 hover:underline">
            <svg
              width="32px"
              height="32px"
              viewBox="0 0 32 32"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g id="SVGRepo_bgCarrier" stroke-width="0" />

              <g
                id="SVGRepo_tracerCarrier"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke="#000"
                stroke-width="6.4"
              >
                <g clip-path="url(#clip0_901_1512)">
                  <path
                    d="M8 16H2M9 20H3M7 12H1M26 16H11M25 20H12M27 12H10M10 24H27C28.125 24 28.862 23.038 29 22L31 8H6L4 1H1M13 29C13 27.896 12.104 27 11 27C9.896 27 9 27.896 9 29C9 30.104 9.896 31 11 31C12.104 31 13 30.104 13 29ZM25 29C25 27.896 24.104 27 23 27C21.896 27 21 27.896 21 29C21 30.104 21.896 31 23 31C24.104 31 25 30.104 25 29Z"
                    stroke="#FFF6F9"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_901_1512">
                    <rect width="32" height="32" fill="white" />
                  </clipPath>
                </defs>
              </g>

              <g id="SVGRepo_iconCarrier">
                <g clip-path="url(#clip0_901_1512)">
                  <path
                    d="M8 16H2M9 20H3M7 12H1M26 16H11M25 20H12M27 12H10M10 24H27C28.125 24 28.862 23.038 29 22L31 8H6L4 1H1M13 29C13 27.896 12.104 27 11 27C9.896 27 9 27.896 9 29C9 30.104 9.896 31 11 31C12.104 31 13 30.104 13 29ZM25 29C25 27.896 24.104 27 23 27C21.896 27 21 27.896 21 29C21 30.104 21.896 31 23 31C24.104 31 25 30.104 25 29Z"
                    stroke="#FFF6F9"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_901_1512">
                    <rect width="32" height="32" fill="white" />
                  </clipPath>
                </defs>
              </g>
            </svg>
          </a>
          <a href="#" class="hover:underline">Login</a>
        </div>
        <button @click="open = !open" class="md:hidden text-white">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            class="w-6 h-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            />
          </svg>
        </button>
      </div>
      <div
        x-show="open"
        @click.away="open = false"
        class="md:hidden mt-4 bg-pink-500"
      >
        <a href="#" class="hover:underline">Wishlist</a>
        <a href="#" class="hover:underline">
          <svg
            width="32px"
            height="32px"
            viewBox="0 0 32 32"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <g id="SVGRepo_bgCarrier" stroke-width="0" />

            <g
              id="SVGRepo_tracerCarrier"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke="#000"
              stroke-width="6.4"
            >
              <g clip-path="url(#clip0_901_1512)">
                <path
                  d="M8 16H2M9 20H3M7 12H1M26 16H11M25 20H12M27 12H10M10 24H27C28.125 24 28.862 23.038 29 22L31 8H6L4 1H1M13 29C13 27.896 12.104 27 11 27C9.896 27 9 27.896 9 29C9 30.104 9.896 31 11 31C12.104 31 13 30.104 13 29ZM25 29C25 27.896 24.104 27 23 27C21.896 27 21 27.896 21 29C21 30.104 21.896 31 23 31C24.104 31 25 30.104 25 29Z"
                  stroke="#FFF6F9"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_901_1512">
                  <rect width="32" height="32" fill="white" />
                </clipPath>
              </defs>
            </g>

            <g id="SVGRepo_iconCarrier">
              <g clip-path="url(#clip0_901_1512)">
                <path
                  d="M8 16H2M9 20H3M7 12H1M26 16H11M25 20H12M27 12H10M10 24H27C28.125 24 28.862 23.038 29 22L31 8H6L4 1H1M13 29C13 27.896 12.104 27 11 27C9.896 27 9 27.896 9 29C9 30.104 9.896 31 11 31C12.104 31 13 30.104 13 29ZM25 29C25 27.896 24.104 27 23 27C21.896 27 21 27.896 21 29C21 30.104 21.896 31 23 31C24.104 31 25 30.104 25 29Z"
                  stroke="#FFF6F9"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </g>
              <defs>
                <clipPath id="clip0_901_1512">
                  <rect width="32" height="32" fill="white" />
                </clipPath>
              </defs>
            </g>
          </svg>
        </a>
        <a href="#" class="hover:underline">Login</a>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto p-6">
      <div class="mt-20 flex justify-between mb-4">
        <select x-model="selectedCategory" class="border p-2 rounded">
          <option value="">All Categories</option>
          <template x-for="category in categories" :key="category">
            <option :value="category" x-text="category"></option>
          </template>
        </select>

        <div class="flex items-center">
          <input
            type="text"
            x-model="searchQuery"
            placeholder="Search products..."
            class="border p-2 rounded-l"
          />
          <button
            @click="searchProducts()"
            class="bg-white text-black border border-l-0 p-2 rounded-r"
          >
            Search
          </button>
        </div>

        <select x-model="sortOrder" class="border p-2 rounded">
          <option value="">Sort by Price</option>
          <option value="asc">Lowest to Highest</option>
          <option value="desc">Highest to Lowest</option>
        </select>
      </div>

      <!-- Loading Stage -->
      <div class="loading text-center text-2xl" x-show="loading">
        Loading...
      </div>

      <!-- Product Card  -->
      <div
        class="grid grid-cols-1 :hidden:grid-cols-2 lg:grid-cols-3 gap-6"
        x-show="!loading"
      >
        <template x-for="product in filteredProducts" :key="product.id">
          <div
            class="card border p-4 rounded shadow hover:shadow-lg transition-shadow duration-300"
            @click="openModal(product)"
          >
            <img
              :src="product.image"
              alt=""
              class="w-320px h-48 object-cover mb-4"
            />
            <h3 class="text-lg font-bold" x-text="product.title"></h3>
            <p class="text-gray-700" x-text="'R' + product.price"></p>
            <p class="text-gray-500" x-text="product.category"></p>
            <p
              class="text-gray-700 mt-2"
              x-text="'Rating: ' + product.rating.rate + ' (' + product.rating.count + ' reviews)'"
            ></p>
            <button @click.stop="toggleFavorite(product.id)" class="">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                class="w-6 h-6 text-gray-300"
                :class="{'text-red-500': isFavorite(product.id)}"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                />
              </svg>
            </button>
            <button class="bg-pink-600 px-4 py-1 text-pink-50">
              Add To Cart +
            </button>
          </div>
        </template>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"
      x-show="showModal"
      @click.self="closeModal()"
    >
      <div class="modal-content bg-white p-6 rounded shadow-lg w-full max-w-md">
        <button class="text-red-500" @click="closeModal()">Close</button>
        <h3 class="text-xl font-bold mt-4" x-text="modalProduct.title"></h3>
        <img
          :src="modalProduct.image"
          alt=""
          class="w-320 h-48 object-cover my-4"
        />
        <p class="text-gray-700" x-text="'R' + modalProduct.price"></p>
        <p class="text-gray-500" x-text="modalProduct.category"></p>
        <p class="text-gray-600" x-text="modalProduct.description"></p>
        <p
          class="text-gray-700 mt-2"
          x-text="'Rating: ' + modalProduct.rating.rate + ' (' + modalProduct.rating.count + ' reviews)'"
        ></p>
        <button class="bg-pink-600 px-4 py-1 text-pink-50">
          Add To Cart +
        </button>
      </div>
    </div>

    <script>
      function store() {
        return {
          products: [],
          filteredProducts: [],
          categories: [],
          searchQuery: "",
          selectedCategory: "",
          sortOrder: "",
          favorites: JSON.parse(localStorage.getItem("favorites")) || [],
          userRating: 0,
          showModal: false,
          modalProduct: {},
          loading: true,

          init() {
            this.fetchProducts();
            this.fetchCategories();
          },

          async fetchProducts() {
            this.loading = true;
            const response = await fetch("https://fakestoreapi.com/products");
            const data = await response.json();
            this.products = data;
            this.filteredProducts = data;
            this.loading = false;
          },

          async fetchCategories() {
            const response = await fetch(
              "https://fakestoreapi.com/products/categories"
            );
            const data = await response.json();
            this.categories = data;
          },

          openModal(product) {
            this.loading = true;
            fetch(`https://fakestoreapi.com/products/${product.id}`)
              .then((response) => response.json())
              .then((data) => {
                this.modalProduct = data;
                this.showModal = true;
                this.loading = false;
              });
          },

          closeModal() {
            this.showModal = false;
          },

          searchProducts() {
            this.filteredProducts = this.products.filter((product) =>
              product.title
                .toLowerCase()
                .includes(this.searchQuery.toLowerCase())
            );
          },

          toggleFavorite(productId) {
            if (this.favorites.includes(productId)) {
              this.favorites = this.favorites.filter((id) => id !== productId);
            } else {
              this.favorites.push(productId);
            }
            localStorage.setItem("favorites", JSON.stringify(this.favorites));
          },

          isFavorite(productId) {
            return this.favorites.includes(productId);
          },

          submitRating(productId) {
            fetch(`https://fakestoreapi.com/products/${productId}`, {
              method: "PATCH",
              body: JSON.stringify({ rating: this.userRating }),
              headers: { "Content-Type": "application/json" },
            })
              .then((response) => response.json())
              .then((data) => {
                this.modalProduct.rating.rate = data.rating.rate;
                this.modalProduct.rating.count = data.rating.count;
                this.closeModal();
              });
          },

          get filteredProducts() {
            let products = this.products;
            if (this.selectedCategory) {
              products = products.filter(
                (product) => product.category === this.selectedCategory
              );
            }
            if (this.sortOrder === "asc") {
              products = products.sort((a, b) => a.price - b.price);
            } else if (this.sortOrder === "desc") {
              products = products.sort((a, b) => b.price - a.price);
            }
            if (this.searchQuery) {
              products = products.filter((product) =>
                product.title
                  .toLowerCase()
                  .includes(this.searchQuery.toLowerCase())
              );
            }
            return products;
          },
        };
      }
    </script>
    <script type="module" src="./main.js"></script>
  </body>
</html>
